plot(1:5,10^(1:5))
plot(1:5,10^(1:5), xlabel = "Number of points", ylabel = "diensions")
plot(1:5,10^(1:5), xlab = "Number of points", ylab = "dimensions")
plot(1:5,10^(1:5))
plot(1:5,3^(1:6))
plot(1:5,3^(1:6))
plot(1:6,3^(1:6))
library(dplyr)
library(ggplot2)
library(reshape2)
library(lubridate)
file <- "sst_bins_avail_sst_bins"
dat <- read.csv(paste0("covars/",file,".csv"))
getwd()
setwd("github/KelpUDE")
setwd("github")
setwd("kelpUDEs")
library(dplyr)
library(ggplot2)
library(reshape2)
library(lubridate)
file <- "sst_bins_avail_sst_bins"
dat <- read.csv(paste0("covars/",file,".csv"))
dat$year <- year(dat$date)
dat$w <- floor(yday(dat$date)/90)
length(unique(dat$latitude))
library(dplyr)
library(ggplot2)
library(reshape2)
library(lubridate)
file <- "sst_bins_avail_sst_bins"
dat <- read.csv(paste0("covars/",file,".csv"))
dat$year <- year(dat$date)
dat$w <- floor(yday(dat$date)/90)
length(unique(dat$latitude))
# load kelp data
file <- "kelp_bins_50_500m_cenca"
dat <- read.csv(paste0("data/",file,".csv"))
dat$year <- year(dat$time)
dat$q<- quarter(dat$time)
library(dplyr)
library(ggplot2)
library(reshape2)
library(lubridate)
file <- "sst_bins_avail_sst_bins"
dat <- read.csv(paste0("covars/",file,".csv"))
dat$year <- year(dat$date)
dat$w <- floor(yday(dat$date)/90)
length(unique(dat$latitude))
# load kelp data
file <- "kelp_bins_50_500m_cenca"
dat_kelp <- read.csv(paste0("data/",file,".csv"))
dat_kelp$year <- year(dat$time)
head(dat)
# Convert both to sf point objects
fine_sf <- st_as_sf(dat_kelp %>% group_by(lat_bin) %>%
summarize(lat = mean(latitude),
lon = mean(laongitude)),
coords = c("lon", "lat"), crs = 4326)
library(sf)
library(dplyr)
# Convert both to sf point objects
fine_sf <- st_as_sf(dat_kelp %>% group_by(lat_bin) %>%
summarize(lat = mean(latitude),
lon = mean(laongitude)),
coords = c("lon", "lat"), crs = 4326)
# Convert both to sf point objects
fine_sf <- st_as_sf(dat_kelp %>% group_by(lat_bin) %>%
summarize(lat = mean(mid_lat),
lon = mean(mid_lon)),
coords = c("lon", "lat"), crs = 4326)
coarse_sf <- st_as_sf(dat %>% group_by(lat_bin) %>%
summarize(lat = mean(latitude),
lon = mean(laongitude)),
coords = c("lon", "lat"), crs = 4326)
# Convert both to sf point objects
fine_sf <- st_as_sf(dat_kelp %>% group_by(lat_bin) %>%
summarize(lat = mean(mid_lat),
lon = mean(mid_lon)),
coords = c("lon", "lat"), crs = 4326)
coarse_sf <- st_as_sf(dat %>% group_by(lat_bin) %>%
summarize(lat = mean(latitude),
lon = mean(longitude)),
coords = c("lon", "lat"), crs = 4326)
# Use nearest neighbor join
matched_sf <- st_join(fine_sf, coarse_sf, join = st_nearest_feature)
# If needed, convert back to a data frame
matched_df <- as.data.frame(matched_sf)
# Optional: remove geometry if not needed
matched_df <- matched_df %>% select(-geometry)
matched_df
# Use nearest neighbor join
matched_sf <- st_join(coarse_sf,fine_sf,  join = st_nearest_feature)
# If needed, convert back to a data frame
matched_df <- as.data.frame(matched_sf)
# Optional: remove geometry if not needed
matched_df <- matched_df %>% select(-geometry)
matched_df
# Use nearest neighbor join
matched_sf <- st_join(fine_sf, coarse_sf, join = st_nearest_feature)
unique(dat_kelp$lat_bin)
# Use nearest neighbor join
matched_sf <- st_join(fine_sf, coarse_sf, join = st_nearest_feature)
# If needed, convert back to a data frame
matched_df <- as.data.frame(matched_sf)
# Optional: remove geometry if not needed
matched_df <- matched_df %>% select(-geometry)
matched_df
file <- "kelp_bins_50_500m_cenca"
dat_kelp <- read.csv(paste0("data/",file,".csv"))
dat_kelp$year <- year(dat$time)
file <- "kelp_bins_50_500m_cenca"
dat_kelp <- read.csv(paste0("data/",file,".csv"))
dat_kelp$year <- year(dat$time)
library(dplyr)
library(ggplot2)
library(reshape2)
library(lubridate)
file <- "sst_bins_avail_sst_bins"
dat <- read.csv(paste0("covars/",file,".csv"))
dat$year <- year(dat$date)
dat$w <- floor(yday(dat$date)/90)
length(unique(dat$latitude))
# load kelp data
file <- "kelp_bins_50_500m_cenca"
dat_kelp <- read.csv(paste0("data/",file,".csv"))
dat_kelp$year <- year(dat$time)
file <- "kelp_bins_50_500m_cenca"
dat_kelp <- read.csv(paste0("data/",file,".csv"))
dat_kelp$year <- year(dat_kelp$time)
dat_kelp$q<- quarter(dat_kelp$time)
i <- 0
for(lat in unique(dat_kelp$lat_bin)){
i <- i+1
print(lat)
}
i <- 0
for(lat in unique(dat_kelp$lat_bin)){
i <- i+1
print(unique(dat_kelp$mid_lat)[i])
}
unique(dat$latitude)
library(dplyr)
library(ggplot2)
library(reshape2)
library(lubridate)
file <- "sst_bins_avail_sst_bins"
dat <- read.csv(paste0("covars/",file,".csv"))
dat$year <- year(dat$date)
dat$w <- floor(yday(dat$date)/90)
length(unique(dat$latitude))
# load kelp data
file <- "kelp_bins_50_500m_cenca"
dat_kelp <- read.csv(paste0("data/",file,".csv"))
dat_kelp$year <- year(dat_kelp$time)
dat_kelp$q<- quarter(dat_kelp$time)
i <- 0
for(lat in unique(dat_kelp$lat_bin)){
i <- i+1
mid_lat <- unique(dat_kelp$mid_lat)[i]
print(argmin(unique(dat$latitude)-mid_lat))
}
for(lat in unique(dat_kelp$lat_bin)){
i <- i+1
mid_lat <- unique(dat_kelp$mid_lat)[i]
print(which.min(unique(dat$latitude)-mid_lat))
}
unique(dat$latitude)
for(lat in unique(dat_kelp$lat_bin)){
i <- i+1
mid_lat <- unique(dat_kelp$mid_lat)[i]
print(which.min((unique(dat$latitude)-mid_lat))^2)
}
i <- 0
for(lat in unique(dat_kelp$lat_bin)){
i <- i+1
mid_lat <- unique(dat_kelp$mid_lat)[i]
print(which.min((unique(dat$latitude)-mid_lat))^2)
}
i <- 0
for(lat in unique(dat_kelp$lat_bin)){
i <- i+1
mid_lat <- unique(dat_kelp$mid_lat)[i]
print((unique(dat$latitude)-mid_lat)^2)
}
for(lat in unique(dat_kelp$lat_bin)){
i <- i+1
mid_lat <- unique(dat_kelp$mid_lat)[i]
print(which.min((unique(dat$latitude)-mid_lat)^2))
}
i <- 0
for(lat in unique(dat_kelp$lat_bin)){
i <- i+1
mid_lat <- unique(dat_kelp$mid_lat)[i]
print(which.min((unique(dat$latitude)-mid_lat)^2))
}
for(lat in unique(dat_kelp$lat_bin)){
i <- i+1
mid_lat <- unique(dat_kelp$mid_lat)[i]
ind <- which.min((unique(dat$latitude)-mid_lat)^2)
print(mid_lat)
print(unique(dat$latitude)[ind])
}
i <- 0
for(lat in unique(dat_kelp$lat_bin)){
i <- i+1
mid_lat <- unique(dat_kelp$mid_lat)[i]
ind <- which.min((unique(dat$latitude)-mid_lat)^2)
print(mid_lat)
print(unique(dat$latitude)[ind])
}
library(dplyr)
library(ggplot2)
library(reshape2)
library(lubridate)
file <- "sst_bins_avail_sst_bins"
dat <- read.csv(paste0("covars/",file,".csv"))
dat$year <- year(dat$date)
dat$w <- floor(yday(dat$date)/90)
length(unique(dat$latitude))
i <- 0
for(lat in unique(dat_kelp$lat_bin)){
i <- i+1
mid_lat <- unique(dat_kelp$mid_lat)[i]
ind <- which.min((unique(dat$latitude)-mid_lat)^2)
print(mid_lat)
print(unique(dat$latitude)[ind])
}
file <- "kelp_bins_50_500m_cenca"
dat_kelp <- read.csv(paste0("data/",file,".csv"))
dat_kelp$year <- year(dat_kelp$time)
dat_kelp$q<- quarter(dat_kelp$time)
i <- 1
mid_lat <- unique(dat_kelp$mid_lat)[i]
ind <- which.min((unique(dat$latitude)-mid_lat)^2)
lat <- unique(dat$latitude)[ind]
dat_new <- dat %>% filter(latitude  == lat)
dat_new$lat_bin = unique(dat_kelp$lat_bin)[i]
for(i in 2:length(unique(dat_kelp$lat_bin))){
mid_lat <- unique(dat_kelp$mid_lat)[i]
ind <- which.min((unique(dat$latitude)-mid_lat)^2)
lat <- unique(dat$latitude)[ind]
dat_new_i <- dat %>% filter(latitude  == lat)
dat_new_i$lat_bin = unique(dat_kelp$lat_bin)[i]
dat_new <- rbind(dat_new,dat_new_i)
}
head(dat_new)
unique(dat_kelp$lat_bin)
unique(dat_kelp$mid_lat)
}
write.csv("process_data/sst_500m_bins.csv")
write.csv(dat_new,"process_data/sst_500m_bins.csv")
write.csv(dat_new,"processed_data/sst_500m_bins.csv")
head(dat_new$yday_group)
unique(dat_new$yday_group)
plot(dat_new$yday_group, dat_new$yday)
length(dat_new$yr_day)
round(dat_new$yr_day/12)
floor(dat_new$yr_day/12)
floor(dat_new$yr_day/30)+1
hist(floor(dat_new$yr_day/30)+1)
hist(floor(dat_new$yr_day/31)+1)
hist(floor(dat_new$yr_day/31.5)+1)
hist(floor(dat_new$yr_day/36.5)+1)
hist(floor(dat_new$yr_day/36.525)+1)
hist(floor(dat_new$yr_day/36.5251)+1)
hist(floor(dat_new$yr_day/36.526)+1)
hist(floor(dat_new$yr_day/36.527)+1)
hist(floor(dat_new$yr_day/36.527)+1)
hist(floor(dat_new$yr_day/36.53)+1)
hist(floor(dat_new$yr_day/36.6)+1)
hist(floor(dat_new$yr_day/36.6)+1)
hist(floor(dat_new$yr_day/36.6))
hist(floor(dat_new$yr_day/36.7))
dat_new %>% mutate(yday_group = floor(dat_new$yr_day/36.7))%>%
group_by(year,yday_group,lat_bin)%>%
summarize(sst = mean(sst_day_mean),
time = mean(year) + mean(yr_day))
dat_new %>% mutate(yday_group = floor(dat_new$yr_day/36.7))%>%
group_by(year,yday_group,lat_bin)%>%
summarize(sst = mean(sst_day_mean),
time = mean(year) + mean(yr_day)/265)
dat_new %>% mutate(yday_group = floor(dat_new$yr_day/36.7))%>%
group_by(lat_bin)%>%
mutate(mean_sst=mean(sst_day_mean))%>%
group_by(year,yday_group,lat_bin)%>%
summarize(sst_anom = mean(sst_day_mean-mean_sst),
time = mean(year) + mean(yr_day)/365.25)
dat_new %>% mutate(yday_group = floor(dat_new$yr_day/36.7))%>%
group_by(lat_bin,yday_group)%>%
mutate(mean_sst=mean(sst_day_mean))%>%
group_by(year,yday_group,lat_bin)%>%
summarize(sst_anom = mean(sst_day_mean-mean_sst),
time = mean(year) + mean(yr_day)/365.25)
write.csv(dat_new,"processed_data/sst_500m_bins.csv")
dat_new %>% mutate(yday_group = floor(dat_new$yr_day/36.7))%>%
group_by(lat_bin,yday_group)%>%
mutate(mean_sst=mean(sst_day_mean))%>%ungroup()%>%
group_by(year,yday_group,lat_bin)%>%
summarize(sst_anom = mean(sst_day_mean-mean_sst),
time = mean(year) + mean(yr_day)/365.25)
hist(floor(4*dat_new$yr_day/365.24))
hist(floor(4*dat_new$yr_day/365.26))
hist(floor(4*dat_new$yr_day/365.3))
hist(floor(4*dat_new$yr_day/365.5))
hist(floor(4*dat_new$yr_day/364))
hist(floor(4*dat_new$yr_day/366))
hist(floor(4*dat_new$yr_day/367))
dat_new %>% mutate(yday_group = floor(4*yr_day/367))%>%
group_by(lat_bin,yday_group)%>%
mutate(mean_sst=mean(sst_day_mean))%>%ungroup()%>%
group_by(year,yday_group,lat_bin)%>%
summarize(sst_anom = mean(sst_day_mean-mean_sst),
time = mean(year) + mean(yr_day)/365.25)
dat_new %>% mutate(yday_group = floor(4*yr_day/367))%>%
group_by(lat_bin,yday_group)%>%
mutate(mean_sst=mean(sst_day_mean))%>%ungroup()%>%
group_by(year,yday_group,lat_bin)%>%
summarize(sst_anom = mean(sst_day_mean-mean_sst),
time = mean(year) + mean(yr_day)/365.25)%>%
mutate(sst_anom = scale(sst_anom))
dat_new %>% mutate(yday_group = floor(4*yr_day/367))%>%
group_by(lat_bin,yday_group)%>%
mutate(mean_sst=mean(sst_day_mean))%>%ungroup()%>%
group_by(year,yday_group,lat_bin)%>%
summarize(sst_anom = mean(sst_day_mean-mean_sst),
time = mean(year) + mean(yr_day)/365.25)%>%
ungroup()%>%group_by(lat_bin)%>%
mutate(sst_anom = scale(sst_anom))
dat_new <- dat_new %>% mutate(yday_group = floor(4*yr_day/367))%>%
group_by(lat_bin,yday_group)%>%
mutate(mean_sst=mean(sst_day_mean))%>%ungroup()%>%
group_by(year,yday_group,lat_bin)%>%
summarize(sst_anom = mean(sst_day_mean-mean_sst),
time = mean(year) + mean(yr_day)/365.25)%>%
ungroup()%>%group_by(lat_bin)%>%
mutate(sst_anom = scale(sst_anom))
hist(dat_new$sst_anom)
hist(dat_new$lat_bin)
hist(dat_new$yday_group)
hist(dat_new$time)
plot(dat_new$time)
write.csv(dat_new,"processed_data/sst_500m_bins.csv")
unique(dat_new$lat_bin)
dat_new <- dat_new %>% mutate(yday_group = floor(4*yr_day/367))%>%
group_by(lat_bin,yday_group)%>%
mutate(mean_sst=mean(sst_day_mean))%>%ungroup()%>%
group_by(year,yday_group,lat_bin)%>%
summarize(sst_anom = mean(sst_day_mean-mean_sst),
time = mean(year) + mean(yr_day)/365.25)%>%
ungroup()%>%group_by(lat_bin)%>%
mutate(sst_anom = scale(sst_anom))%>%
filter(!(lat_bin %in% c("36_00")))
library(dplyr)
library(ggplot2)
library(reshape2)
library(lubridate)
file <- "sst_bins_avail_sst_bins"
dat <- read.csv(paste0("covars/",file,".csv"))
dat$year <- year(dat$date)
dat$w <- floor(yday(dat$date)/90)
length(unique(dat$latitude))
# load kelp data
file <- "kelp_bins_50_500m_cenca"
dat_kelp <- read.csv(paste0("data/",file,".csv"))
dat_kelp$year <- year(dat_kelp$time)
dat_kelp$q<- quarter(dat_kelp$time)
i <- 1
mid_lat <- unique(dat_kelp$mid_lat)[i]
ind <- which.min((unique(dat$latitude)-mid_lat)^2)
lat <- unique(dat$latitude)[ind]
dat_new <- dat %>% filter(latitude  == lat)
dat_new$lat_bin = unique(dat_kelp$lat_bin)[i]
for(i in 2:length(unique(dat_kelp$lat_bin))){
mid_lat <- unique(dat_kelp$mid_lat)[i]
ind <- which.min((unique(dat$latitude)-mid_lat)^2)
lat <- unique(dat$latitude)[ind]
dat_new_i <- dat %>% filter(latitude  == lat)
dat_new_i$lat_bin = unique(dat_kelp$lat_bin)[i]
dat_new <- rbind(dat_new,dat_new_i)
}
dat_new <- dat_new %>% mutate(yday_group = floor(4*yr_day/367))%>%
group_by(lat_bin,yday_group)%>%
mutate(mean_sst=mean(sst_day_mean))%>%ungroup()%>%
group_by(year,yday_group,lat_bin)%>%
summarize(sst_anom = mean(sst_day_mean-mean_sst),
time = mean(year) + mean(yr_day)/365.25)%>%
ungroup()%>%group_by(lat_bin)%>%
mutate(sst_anom = scale(sst_anom))%>%
filter(!(lat_bin %in% c("36_00")))
write.csv(dat_new,"processed_data/sst_500m_bins.csv")
library(dplyr)
library(ggplot2)
library(reshape2)
library(lubridate)
file <- "sst_bins_avail_sst_bins"
dat <- read.csv(paste0("covars/",file,".csv"))
dat$year <- year(dat$date)
dat$w <- floor(yday(dat$date)/90)
length(unique(dat$latitude))
# load kelp data
file <- "kelp_bins_50_500m_cenca"
dat_kelp <- read.csv(paste0("data/",file,".csv"))
dat_kelp$year <- year(dat_kelp$time)
dat_kelp$q<- quarter(dat_kelp$time)
i <- 1
mid_lat <- unique(dat_kelp$mid_lat)[i]
ind <- which.min((unique(dat$latitude)-mid_lat)^2)
lat <- unique(dat$latitude)[ind]
dat_new <- dat %>% filter(latitude  == lat)
dat_new$lat_bin = unique(dat_kelp$lat_bin)[i]
for(i in 2:length(unique(dat_kelp$lat_bin))){
mid_lat <- unique(dat_kelp$mid_lat)[i]
ind <- which.min((unique(dat$latitude)-mid_lat)^2)
lat <- unique(dat$latitude)[ind]
dat_new_i <- dat %>% filter(latitude  == lat)
dat_new_i$lat_bin = unique(dat_kelp$lat_bin)[i]
dat_new <- rbind(dat_new,dat_new_i)
}
dat_new <- dat_new %>% mutate(yday_group = floor(4*yr_day/367))%>%
group_by(lat_bin,yday_group)%>%
mutate(mean_sst=mean(sst_day_mean))%>%ungroup()%>%
group_by(year,yday_group,lat_bin)%>%
summarize(sst_anom = mean(sst_day_mean-mean_sst),
time = mean(year) + mean(yr_day)/365.25)%>%
ungroup()%>%group_by(lat_bin)%>%
mutate(sst_anom = scale(sst_anom))%>%
filter(!(lat_bin %in% c("36_00")))%>%
mutate(year = time, variable = lat_bin,
value = sst_anom)
select(-time,-yday_group,-sst_anom)
library(dplyr)
library(ggplot2)
library(reshape2)
library(lubridate)
file <- "sst_bins_avail_sst_bins"
dat <- read.csv(paste0("covars/",file,".csv"))
dat$year <- year(dat$date)
dat$w <- floor(yday(dat$date)/90)
length(unique(dat$latitude))
# load kelp data
file <- "kelp_bins_50_500m_cenca"
dat_kelp <- read.csv(paste0("data/",file,".csv"))
dat_kelp$year <- year(dat_kelp$time)
dat_kelp$q<- quarter(dat_kelp$time)
i <- 1
mid_lat <- unique(dat_kelp$mid_lat)[i]
ind <- which.min((unique(dat$latitude)-mid_lat)^2)
lat <- unique(dat$latitude)[ind]
dat_new <- dat %>% filter(latitude  == lat)
dat_new$lat_bin = unique(dat_kelp$lat_bin)[i]
for(i in 2:length(unique(dat_kelp$lat_bin))){
mid_lat <- unique(dat_kelp$mid_lat)[i]
ind <- which.min((unique(dat$latitude)-mid_lat)^2)
lat <- unique(dat$latitude)[ind]
dat_new_i <- dat %>% filter(latitude  == lat)
dat_new_i$lat_bin = unique(dat_kelp$lat_bin)[i]
dat_new <- rbind(dat_new,dat_new_i)
}
dat_new_ <- dat_new %>% mutate(yday_group = floor(4*yr_day/367))%>%
group_by(lat_bin,yday_group)%>%
mutate(mean_sst=mean(sst_day_mean))%>%ungroup()%>%
group_by(year,yday_group,lat_bin)%>%
summarize(sst_anom = mean(sst_day_mean-mean_sst),
time = mean(year) + mean(yr_day)/365.25)%>%
ungroup()%>%group_by(lat_bin)%>%
mutate(sst_anom = scale(sst_anom))%>%
filter(!(lat_bin %in% c("36_00")))%>%
mutate(year = time, variable = lat_bin,
value = sst_anom)%>%
select(-time,-yday_group,-sst_anom)
write.csv(dat_new_,"processed_data/sst_500m_bins.csv")
dat_new_ <- dat_new %>% mutate(yday_group = floor(4*yr_day/367))%>%
group_by(lat_bin,yday_group)%>%
mutate(mean_sst=mean(sst_day_mean))%>%ungroup()%>%
group_by(year,yday_group,lat_bin)%>%
summarize(sst_anom = mean(sst_day_mean-mean_sst),
time = mean(year) + mean(yr_day)/365.25)%>%
ungroup()%>%group_by(lat_bin)%>%
mutate(sst_anom = scale(sst_anom))%>%
filter(!(lat_bin %in% c("36_00")))%>%
mutate(year = time, variable = lat_bin,
value = sst_anom)%>%
select(-time,-yday_group,-sst_anom,-lat_bin)
write.csv(dat_new_,"processed_data/sst_500m_bins.csv")
dat_new_ <- dat_new %>% mutate(yday_group = floor(4*yr_day/367))%>%
group_by(lat_bin,yday_group)%>%
mutate(mean_sst=mean(sst_day_mean))%>%ungroup()%>%
group_by(year,yday_group,lat_bin)%>%
summarize(sst_anom = mean(sst_day_mean-mean_sst),
time = mean(year) + mean(yr_day)/365.25)%>%
ungroup()%>%group_by(lat_bin)%>%
mutate(sst_anom = scale(sst_anom))%>%
filter(!(lat_bin %in% c("36_00")))%>%
mutate(year = time, variable = lat_bin,
value = sst_anom)%>%ungroup()%>%
select(-time,-yday_group,-sst_anom,-lat_bin)
write.csv(dat_new_,"processed_data/sst_500m_bins.csv")
head(dat_new_)
dat_new_ %>% dcast(year ~ variable )
library(dplyr)
library(ggplot2)
library(reshape2)
library(lubridate)
file <- "sst_bins_avail_sst_bins"
dat <- read.csv(paste0("covars/",file,".csv"))
dat$year <- year(dat$date)
dat$w <- floor(yday(dat$date)/90)
length(unique(dat$latitude))
dat_cast <- dat_new_ %>% dcast(year ~ variable )
plot(dat_cast$lat_36_00450,dat_cast$lat_36_22047
)
